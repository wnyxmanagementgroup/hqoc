<!DOCTYPE html>
<html>
<head>
    <title>API Proxy</title>
</head>
<body>
    <script>
        // CORS Proxy for Google Apps Script
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbyMjOGrKm39x6fOH8ciiB-9ikBQlElOyUEUCx_fxbxHSO5aW9meiE7ZZBz_i9wvhdWb/exec';
        
        async function handleRequest(request) {
            const url = new URL(request.url);
            const action = url.searchParams.get('action');
            
            if (!action) {
                return new Response(JSON.stringify({error: 'Action parameter required'}), {
                    status: 400,
                    headers: {'Content-Type': 'application/json'}
                });
            }
            
            try {
                // Forward request to Google Apps Script
                const gasResponse = await fetch(GAS_URL + '?' + url.searchParams.toString());
                const data = await gasResponse.text();
                
                return new Response(data, {
                    status: 200,
                    headers: {
                        'Content-Type': 'application/json',
                        'Access-Control-Allow-Origin': '*',
                        'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
                        'Access-Control-Allow-Headers': 'Content-Type'
                    }
                });
            } catch (error) {
                return new Response(JSON.stringify({error: error.message}), {
                    status: 500,
                    headers: {
                        'Content-Type': 'application/json',
                        'Access-Control-Allow-Origin': '*'
                    }
                });
            }
        }
        
        // Service Worker style handling
        if (navigator.serviceWorker) {
            // This is for demonstration - in real use, you'd deploy this as a server
            console.log('Proxy ready');
        }
        
        // For direct usage
        window.proxyRequest = async function(action, params = {}) {
            const searchParams = new URLSearchParams({action, ...params});
            const response = await fetch(window.location.href + '?' + searchParams.toString());
            return await response.json();
        };
    </script>
</body>
</html>
